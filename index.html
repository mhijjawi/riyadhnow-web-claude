<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Security: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com https://www.gstatic.com 'unsafe-inline'; style-src 'self' https://unpkg.com https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: http:; connect-src 'self' https://places-830507251115.europe-west1.run.app https://get-similar-places-830507251115.europe-west1.run.app https://www.google-analytics.com https://*.googleapis.com https://firebaseinstallations.googleapis.com https://*.tile.openstreetmap.org https://*.cartocdn.com https://fonts.googleapis.com https://fonts.gstatic.com; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">

  <!-- SEO Meta Tags -->
  <title>RiyadhNow โ Smart Map</title>
  <meta name="description" content="ุงูุชุดู ุฃูุถู ุงูุฃูุงูู ูุงููุทุงุนู ูู ุงูุฑูุงุถ - ุฎุฑูุทุฉ ุฐููุฉ ุชุณุงุนุฏู ูู ุงุฎุชูุงุฑ ูุฌูุชู ุงููุงุฏูุฉ ุจูุงุกู ุนูู ุงูุชููููุงุช ูุงููุฑุงุฌุนุงุช ุงูุญููููุฉ">
  <meta name="keywords" content="ุงูุฑูุงุถ, ูุทุงุนู ุงูุฑูุงุถ, ุฃูุงูู ูู ุงูุฑูุงุถ, ุฎุฑูุทุฉ ุงูุฑูุงุถ, Riyadh, Riyadh restaurants">
  <meta name="author" content="RiyadhNow">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://riyadhnow.com">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://riyadhnow.com">
  <meta property="og:title" content="RiyadhNow โ Smart Map">
  <meta property="og:description" content="ุงูุชุดู ุฃูุถู ุงูุฃูุงูู ูุงููุทุงุนู ูู ุงูุฑูุงุถ - ุฎุฑูุทุฉ ุฐููุฉ ุชุณุงุนุฏู ูู ุงุฎุชูุงุฑ ูุฌูุชู ุงููุงุฏูุฉ">
  <meta property="og:image" content="https://riyadhnow.com/android-chrome-512.png">
  <meta property="og:locale" content="ar_SA">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://riyadhnow.com">
  <meta name="twitter:title" content="RiyadhNow โ Smart Map">
  <meta name="twitter:description" content="ุงูุชุดู ุฃูุถู ุงูุฃูุงูู ูุงููุทุงุนู ูู ุงูุฑูุงุถ">
  <meta name="twitter:image" content="https://riyadhnow.com/android-chrome-512.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Security Note: Add integrity hashes in production for supply chain protection -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="styles.css" />
<!-- Firebase Analytics (GA4) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics, isSupported } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAYpGdVodmCGlvD--fK1fvcOX3urf17Zj0",
    authDomain: "riyadhnow-web-11983408-d940e.firebaseapp.com",
    projectId: "riyadhnow-web-11983408-d940e",
    storageBucket: "riyadhnow-web-11983408-d940e.firebasestorage.app",
    messagingSenderId: "853594102106",
    appId: "1:853594102106:web:f1c3365c6da73a24f27b63",
    measurementId: "G-MHVRB87LMM"
  };

  const app = initializeApp(firebaseConfig);

  // Enable analytics only when supported (avoids console errors in some environments)
  isSupported().then((ok) => {
    if (ok) getAnalytics(app);
  }).catch(() => {
    // no-op
  });
</script>
</head>
<body>
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <div class="app">
    <!-- Map canvas -->
    <main class="map" aria-label="Map">
      <div id="map" aria-label="Map"></div>

      <!-- ALWAYS VISIBLE TOP BAR -->
      <div class="topbar" aria-label="Top controls">
        <!-- Search with embedded District selector -->
        <div class="search search--combo">
          <span class="search__icon" aria-hidden="true">๐</span>

          <select id="district" class="search__select" aria-label="ุงูุญู">
            <option value="all">ุงููู</option>
            <option value="Olaya">Olaya</option>
            <option value="Nakheel">Nakheel</option>
            <option value="Yasmin">Yasmin</option>
            <option value="Sulaimaniyah">Sulaimaniyah</option>
            <option value="Qurtubah">Qurtubah</option>
          </select>

          <div class="search__divider" aria-hidden="true"></div>

          <input id="q" class="search__input" type="search" placeholder="ุงุจุญุซ ุจุงููุณู... ูุซุงู: ุจุฑุฌุฑุ ูููุฉุ ุฌูุณุฉ..." autocomplete="off" />

          <button id="clearQ" class="iconbtn" title="ูุณุญ" aria-label="ูุณุญ ุงูุจุญุซ">โ</button>
        </div>

        <!-- COMBINED ROW: Insights + Categories as dropdown pills -->
        <div class="topChips" aria-label="Insights and categories row">
          <button class="chip chip--top" data-menu="insightTop">
            <span class="chip__label">ุงูุชุฑุดูุญุงุช</span>
            <span class="chip__value" id="insightTopValue">ุงููู</span>
            <span class="chip__chev">โพ</span>
          </button>

          <button class="chip chip--top" data-menu="catsTop">
            <span class="chip__label">ุงูุชุตูููุงุช</span>
            <span class="chip__value" id="catsTopValue">ุงููู</span>
            <span class="chip__chev">โพ</span>
          </button>

          <button class="chip chip--top chip--icon" id="resetTop" type="button" title="ุฅุนุงุฏุฉ ุถุจุท" aria-label="ุฅุนุงุฏุฉ ุถุจุท">โบ</button>
        </div>

        <!-- Top menus (for combined row) -->
        <div class="topMenus">
          <div class="menu menu--top" id="menu-insightTop" role="dialog" aria-label="Insight menu (top)">
            <div class="menu__title">ุงูุชุฑุดูุญุงุช</div>
            <div class="menu__items" id="insightTopItems"></div>
          </div>

          <div class="menu menu--top" id="menu-catsTop" role="dialog" aria-label="Categories menu (top)">
            <div class="menu__header">
              <div class="menu__title">ุงูุชุตูููุงุช</div>
              <button class="btn btn--ghost btn--sm" id="clearCatsTop">ูุณุญ</button>
            </div>
            <div class="menu__sub">ุงุฎุชุฑ ุฃูุซุฑ ูู ุชุตููู</div>
            <div class="menu__items menu__items--wrap" id="catsTopItems"></div>
          </div>
        </div>
      </div>

      
      <button class="locateBtn" id="locateBtn" aria-label="Locate me" title="Locate me">๐</button>

      <!-- NOTE: mockup pin dots removed for real map -->
    </main>

    <!-- Unified Panel (collapsible) -->
    <aside class="panel" id="panel" aria-label="Filters and results">
      <div class="panel__handle" id="panelHandle" aria-label="Drag to resize panel">
        <div class="grab" aria-hidden="true"></div>
        <button class="collapseBtn" id="collapseBtn" aria-label="Collapse panel" title="Collapse">โพ</button>
      </div>

      <header class="panel__top">
        <!-- One-row filters like Google Maps -->
        <div class="filtersRow" aria-label="Quick filters row">
          <button class="chip" data-menu="sentiment">
            <span class="chip__label">ุงููุดุงุนุฑ</span>
            <span class="chip__value" id="sentimentValue">ุงููู</span>
            <span class="chip__chev">โพ</span>
          </button>

          <button class="chip" data-menu="price">
            <span class="chip__label">ุงูุณุนุฑ</span>
            <span class="chip__value" id="priceValue">ุงููู</span>
            <span class="chip__chev">โพ</span>
          </button>

          <button class="chip" data-menu="tags">
            <span class="chip__label">ูุณูู</span>
            <span class="chip__value" id="tagsValue">ุงููู</span>
            <span class="chip__chev">โพ</span>
          </button>

          <button class="chip" data-menu="heatmap">
            <span class="chip__label">Heatmap</span>
            <span class="chip__value" id="heatmapValue">Off</span>
            <span class="chip__chev">โพ</span>
          </button>

          <button id="resetAll" class="chip chip--ghost">
            <span class="chip__label">ุฅุนุงุฏุฉ</span>
            <span class="chip__value">ุงูุถุจุท</span>
          </button>
        </div>

        <!-- Panel dropdown menus -->
        <div class="menus">
          <div class="menu" id="menu-sentiment" role="dialog" aria-label="Sentiment menu">
            <div class="menu__title">ุงููุดุงุนุฑ</div>
            <div class="menu__items" id="sentimentItems"></div>
          </div>

          <div class="menu" id="menu-price" role="dialog" aria-label="Price menu">
            <div class="menu__title">ุงูุณุนุฑ</div>
            <div class="menu__items" id="priceItems"></div>
          </div>

          <div class="menu" id="menu-tags" role="dialog" aria-label="Tags menu">
            <div class="menu__header">
              <div class="menu__title">ูุณูู</div>
              <button class="btn btn--ghost btn--sm" id="clearTags">ูุณุญ</button>
            </div>
            <div class="menu__sub" id="tagsSub">ุงุฎุชุฑ ุฃูุซุฑ ูู ูุณู</div>
            <div class="menu__search" aria-label="ุจุญุซ ุงููุณูู">
              <input id="tagsSearch" class="menu__searchInput" type="search" placeholder="ุงุจุญุซ ุนู ูุณู..." autocomplete="off" />
              <button id="tagsSearchClear" class="iconbtn" title="ูุณุญ" aria-label="ูุณุญ ุจุญุซ ุงููุณูู">โ</button>
            </div>
            <div class="menu__items menu__items--wrap" id="tagsItems"></div>
          </div>

          <div class="menu" id="menu-heatmap" role="dialog" aria-label="Heatmap menu">
            <div class="menu__title">Heatmap</div>
            <div class="menu__items" id="heatmapItems"></div>
          </div>
        </div>
      </header>

      <section class="results">
        <div class="results__head">
          <div class="results__title" id="resultsTitle">ูุงุฆูุฉ ุงูุฃูุงูู</div>
          <div class="results__meta" id="resultsMeta">โ</div>
        </div>

        <div id="resultsList" class="results__list" aria-label="Results list"></div>
      </section>
    </aside>
  </div>

  <script src="app.js"></script>
</body>
</html>
